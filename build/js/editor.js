var SiteForgeEditor=function(e,t,l,r,o,i,n,s,a){"use strict";const c=e=>{if(void 0===window.siteforgeBlocks)return null;const t=window.siteforgeBlocks[e];if(!(null==t?void 0:t.fields))return null;const l=t.fields;return Array.isArray(l)&&0!==l.length?l:null},d=e=>void 0===window.siteforgeBlocks?null:window.siteforgeBlocks[e]||null,p={add:(e,t)=>[...e||[],t],remove:(e,t)=>(e||[]).filter((e,l)=>l!==t),move:(e,t,l)=>{const r=[...e||[]],[o]=r.splice(t,1);return r.splice(l,0,o),r},update:(e,t,l)=>{const r=[...e||[]];return r[t]=l,r},updateProp:(e,t,l,r)=>{const o=[...e||[]];return o[t]={...o[t],[l]:r},o}},u={isEmpty:e=>!e||(!(!Array.isArray(e)||0!==e.length)||"object"==typeof e&&0===Object.keys(e).length),getUrl:e=>u.isEmpty(e)?"":"string"==typeof e?e:"object"==typeof e&&(null==e?void 0:e.url)?e.url:"",getId:e=>u.isEmpty(e)?null:"number"==typeof e?e:"object"==typeof e&&(null==e?void 0:e.id)?e.id:null,formatValue:(e,t="url")=>{if(!e)return"";switch(t){case"id":return e.id;case"url":default:return e.url;case"object":return{id:e.id,url:e.url,alt:e.alt||"",title:e.title||"",width:e.width,height:e.height}}}},g={setProp:(e,t,l)=>({...e||{},[t]:l}),getProp:(e,t,l="")=>(null==e?void 0:e[t])??l,merge:(...e)=>Object.assign({},...e)},f=(e,t)=>({name:e,type:t.type||"text",label:t.label||e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),config:t}),h=e=>{const t={};return e&&Object.entries(e).forEach(([e,l])=>{void 0!==l.default&&(t[e]=l.default)}),t},m={classNames:(...e)=>e.flat().filter(e=>"string"==typeof e?e:"object"==typeof e&&null!==e?Object.entries(e).filter(([,e])=>e).map(([e])=>e).join(" "):"").join(" ").trim(),inlineStyle:e=>{const t={};return Object.entries(e||{}).forEach(([e,l])=>{null!=l&&""!==l&&(t[e]=l)}),t}},x={isEmpty:e=>null==e||("string"==typeof e?""===e.trim():Array.isArray(e)?0===e.length:"object"==typeof e&&0===Object.keys(e).length),isValidUrl:e=>{try{return new URL(e),!0}catch{return!1}},isValidEmail:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},b=(e,t)=>l=>{e({[t]:l})},v=(e,t)=>{const l={};return t.forEach(t=>{l[t]=b(e,t)}),l},y={getBlockFields:c,getBlockData:d,arrayHelpers:p,imageHelpers:u,objectHelpers:g,styleHelpers:m,validationHelpers:x,normalizeField:f,createRepeaterItemDefaults:h,createGroupDefaults:h,createAttributeSetter:b,createAttributeSetters:v};var j,k,_={exports:{}},w={};var C=(k||(k=1,_.exports=function(){if(j)return w;j=1;var e=l,t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function s(e,l,r){var s,a={},c=null,d=null;for(s in void 0!==r&&(c=""+r),void 0!==l.key&&(c=""+l.key),void 0!==l.ref&&(d=l.ref),l)o.call(l,s)&&!n.hasOwnProperty(s)&&(a[s]=l[s]);if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===a[s]&&(a[s]=l[s]);return{$$typeof:t,type:e,key:c,ref:d,props:a,_owner:i.current}}return w.Fragment=r,w.jsx=s,w.jsxs=s,w}()),_.exports);const S=({type:e,children:t,className:l=""})=>C.jsx("div",{className:`siteforge-field-control siteforge-${e}-control ${l}`.trim(),children:t}),F=({label:e,help:t})=>C.jsxs(C.Fragment,{children:[e&&C.jsx("label",{className:"siteforge-field-label",children:e}),t&&C.jsx("p",{className:"siteforge-field-help",children:t})]});let B={};const T=e=>B[e]||null,E=(e,t,l)=>e?Object.entries(e).map(([e,r])=>((e,t,l,r)=>{const o=B[t.type];return o?C.jsx(o,{field:f(e,t),value:l,onChange:r},e):(console.warn(`[SiteForge] Unknown sub-field type: ${t.type}`),null)})(e,r,null==t?void 0:t[e],t=>l(e,t))):null,N=({field:e,value:t,onChange:l})=>{var r,i,n;return C.jsx(S,{type:"text",children:C.jsx(o.TextControl,{label:e.label,value:t||"",onChange:l,placeholder:(null==(r=e.config)?void 0:r.placeholder)||"",help:(null==(i=e.config)?void 0:i.help)||"",required:(null==(n=e.config)?void 0:n.required)||!1})})},A=({field:e,value:t,onChange:l})=>{var r,i,n;return C.jsx(S,{type:"textarea",children:C.jsx(o.TextareaControl,{label:e.label,value:t||"",onChange:l,placeholder:(null==(r=e.config)?void 0:r.placeholder)||"",rows:(null==(i=e.config)?void 0:i.rows)||4,help:(null==(n=e.config)?void 0:n.help)||""})})},I=({field:e,value:l,onChange:r})=>{var o,n;return C.jsxs(S,{type:"wysiwyg",children:[C.jsx(F,{label:e.label,help:null==(o=e.config)?void 0:o.help}),C.jsx(i.RichText,{tagName:"div",value:l||"",onChange:r,placeholder:(null==(n=e.config)?void 0:n.placeholder)||t.__("Enter content...","siteforge")})]})},L=({field:e,value:t,onChange:l})=>{const r=e.config||{};return C.jsx(S,{type:"number",children:C.jsx(o.TextControl,{label:e.label,type:"number",value:void 0!==t?t:"",onChange:e=>l(e?Number(e):""),min:r.min,max:r.max,step:r.step||1,help:r.help||""})})},O=({field:e,value:t,onChange:l})=>{const r=e.config||{};return C.jsx(S,{type:"range",children:C.jsx(o.RangeControl,{label:e.label,value:t??r.default??50,onChange:l,min:r.min??0,max:r.max??100,step:r.step||1,help:r.help||""})})},P=({field:e,value:t,onChange:l})=>{var r,i;return C.jsx(S,{type:"url",children:C.jsx(o.TextControl,{label:e.label,type:"url",value:t||"",onChange:l,placeholder:(null==(r=e.config)?void 0:r.placeholder)||"https://",help:(null==(i=e.config)?void 0:i.help)||""})})},R=({field:e,value:t,onChange:l})=>{var r,i;return C.jsx(S,{type:"email",children:C.jsx(o.TextControl,{label:e.label,type:"email",value:t||"",onChange:l,placeholder:(null==(r=e.config)?void 0:r.placeholder)||"email@example.com",help:(null==(i=e.config)?void 0:i.help)||""})})},$=({field:e,value:t,onChange:l})=>{var r,i,n;const s=(null==(r=e.config)?void 0:r.choices)||{},a=Object.entries(s).map(([e,t])=>({value:e,label:t}));return C.jsx(S,{type:"select",children:C.jsx(o.SelectControl,{label:e.label,value:t||(null==(i=e.config)?void 0:i.default)||"",options:a,onChange:l,help:(null==(n=e.config)?void 0:n.help)||""})})},U=({field:e,value:t,onChange:l})=>{var r;return C.jsx(S,{type:"checkbox",children:C.jsx(o.CheckboxControl,{label:e.label,checked:t||!1,onChange:l,help:(null==(r=e.config)?void 0:r.help)||""})})},H=U,z=({field:e,value:t,onChange:l})=>{var r,i;return C.jsxs(S,{type:"color",children:[C.jsx(F,{label:e.label,help:null==(r=e.config)?void 0:r.help}),C.jsx(o.ColorPicker,{color:t||(null==(i=e.config)?void 0:i.default)||"#000000",onChangeComplete:e=>l(e.hex)})]})},D=({field:e,value:l,onChange:r})=>{var n,s;const a=(null==(n=e.config)?void 0:n.return_value)||"url",c=u.getUrl(l);return C.jsxs(S,{type:"image",children:[C.jsx(F,{label:e.label,help:null==(s=e.config)?void 0:s.help}),C.jsx(i.MediaUploadCheck,{children:C.jsx(i.MediaUpload,{onSelect:e=>{r(u.formatValue(e,a))},allowedTypes:["image"],value:u.getId(l),render:({open:l})=>C.jsxs("div",{className:"siteforge-image-field",children:[c&&C.jsx("img",{src:c,alt:e.label,className:"siteforge-image-preview",style:{maxWidth:"100%",height:"auto",marginBottom:"8px"}}),C.jsxs("div",{className:"siteforge-image-buttons",children:[C.jsx(o.Button,{variant:"secondary",onClick:l,children:c?t.__("Change Image","siteforge"):t.__("Select Image","siteforge")}),c&&C.jsx(o.Button,{variant:"link",isDestructive:!0,onClick:()=>r(""),style:{marginLeft:"8px"},children:t.__("Remove","siteforge")})]})]})})})]})},M=({field:e,value:l,onChange:r})=>{var n,s,a;const c=(null==(n=e.config)?void 0:n.return_value)||"url",d=u.getUrl(l),p=d?d.split("/").pop():"";return C.jsxs(S,{type:"file",children:[C.jsx(F,{label:e.label,help:null==(s=e.config)?void 0:s.help}),C.jsx(i.MediaUploadCheck,{children:C.jsx(i.MediaUpload,{onSelect:e=>{r(u.formatValue(e,c))},allowedTypes:null==(a=e.config)?void 0:a.allowed_types,value:u.getId(l),render:({open:e})=>C.jsxs("div",{className:"siteforge-file-field",children:[d&&C.jsx("div",{className:"siteforge-file-info",style:{marginBottom:"8px"},children:C.jsx("span",{children:p})}),C.jsxs("div",{className:"siteforge-file-buttons",children:[C.jsx(o.Button,{variant:"secondary",onClick:e,children:d?t.__("Change File","siteforge"):t.__("Select File","siteforge")}),d&&C.jsx(o.Button,{variant:"link",isDestructive:!0,onClick:()=>r(""),style:{marginLeft:"8px"},children:t.__("Remove","siteforge")})]})]})})})]})},W=({field:e,value:l,onChange:i})=>{var s;const[a,c]=r.useState([]),[d,p]=r.useState(!0),[u,g]=r.useState(""),[f,h]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const e=await n({path:"/siteforge/v1/icons"});c(e.icons||[])}catch(e){console.error("[SiteForge] Error loading icons:",e),c([])}p(!1)})()},[]);const m=a.filter(e=>e.toLowerCase().includes(u.toLowerCase())),x=(null==(s=window.siteforgeConfig)?void 0:s.spriteUrl)||"",b=e.config||{};return C.jsxs(S,{type:"icon",children:[C.jsx(F,{label:e.label,help:b.help}),C.jsxs("div",{className:"siteforge-icon-field",children:[C.jsxs("div",{className:"siteforge-icon-selected",style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[l&&x&&C.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",style:{display:"inline-block",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},"aria-hidden":"true",children:C.jsx("use",{href:`${x}#${l}`})}),C.jsx("span",{style:{color:l?"inherit":"#757575"},children:l||t.__("Aucune icÃ´ne sÃ©lectionnÃ©e","siteforge")})]}),C.jsxs("div",{className:"siteforge-icon-buttons",style:{display:"flex",gap:"8px"},children:[C.jsx(o.Button,{variant:"secondary",onClick:()=>h(!f),children:f?t.__("Fermer","siteforge"):t.__("Choisir une icÃ´ne","siteforge")}),l&&C.jsx(o.Button,{variant:"link",isDestructive:!0,onClick:()=>i(""),children:t.__("Supprimer","siteforge")})]}),f&&C.jsxs("div",{className:"siteforge-icon-picker",style:{marginTop:"12px",padding:"12px",border:"1px solid #ddd",borderRadius:"4px",backgroundColor:"#fff"},children:[C.jsx(o.TextControl,{placeholder:t.__("Rechercher une icÃ´ne...","siteforge"),value:u,onChange:g,style:{marginBottom:"12px"}}),d?C.jsx("div",{style:{textAlign:"center",padding:"20px"},children:C.jsx(o.Spinner,{})}):C.jsxs(C.Fragment,{children:[C.jsx("div",{className:"siteforge-icon-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(40px, 1fr))",gap:"4px",maxHeight:"250px",overflowY:"auto",padding:"4px"},children:m.slice(0,200).map(e=>C.jsx("button",{type:"button",title:e,onClick:()=>{i(e),h(!1),g("")},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",padding:"8px",border:l===e?"2px solid #007cba":"1px solid #ddd",borderRadius:"4px",backgroundColor:l===e?"#f0f7fc":"#fff",cursor:"pointer",transition:"all 0.15s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f5f5f5",e.currentTarget.style.borderColor="#007cba"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=l===e?"#f0f7fc":"#fff",t.currentTarget.style.borderColor=l===e?"#007cba":"#ddd"},children:x?C.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",style:{fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},"aria-hidden":"true",children:C.jsx("use",{href:`${x}#${e}`})}):C.jsx("span",{style:{fontSize:"10px"},children:e.slice(0,3)})},e))}),C.jsx("p",{style:{marginTop:"8px",fontSize:"12px",color:"#757575"},children:m.length>200?`${t.__("Affichage des 200 premiers sur","siteforge")} ${m.length} ${t.__("icÃ´nes","siteforge")}`:`${m.length} ${t.__("icÃ´ne(s) trouvÃ©e(s)","siteforge")}`})]})]})]})]})},V=({field:e,value:l,onChange:i})=>{const s=e.config||{},a=s.modes||["link","page","phone","email"],c=s.default_mode||a[0],d=l||{mode:c,label:"",url:"",postId:null,postTitle:"",phone:"",email:"",target:"_self"},[p,u]=r.useState([]),[g,f]=r.useState(!1),[h,m]=r.useState(d.postTitle||""),x=(e,t)=>{i({...d,[e]:t})};r.useEffect(()=>{const e=setTimeout(()=>{"page"===d.mode&&(async e=>{if(!e||e.length<2)u([]);else{f(!0);try{const t=s.post_types||["post","page"],l=await n({path:`/wp/v2/search?search=${encodeURIComponent(e)}&type=post&subtype=${t.join(",")}&per_page=10`});u(l.map(e=>({value:e.id,label:`${e.title} (${e.subtype})`,title:e.title})))}catch(t){console.error("[SiteForge] Search error:",t),u([])}f(!1)}})(h)},300);return()=>clearTimeout(e)},[h,d.mode]);const b={link:t.__("Lien","siteforge"),page:t.__("Page","siteforge"),phone:t.__("TÃ©lÃ©phone","siteforge"),email:t.__("Email","siteforge")},v={link:"ðŸ”—",page:"ðŸ“„",phone:"ðŸ“ž",email:"âœ‰ï¸"};return C.jsxs(S,{type:"link",children:[C.jsx(F,{label:e.label,help:s.help}),C.jsx("div",{className:"siteforge-link-modes",style:{marginBottom:"12px"},children:C.jsx(o.ButtonGroup,{children:a.map(e=>C.jsxs(o.Button,{variant:d.mode===e?"primary":"secondary",onClick:()=>x("mode",e),size:"small",children:[v[e]," ",b[e]]},e))})}),C.jsx(o.TextControl,{label:t.__("Texte du lien","siteforge"),value:d.label||"",onChange:e=>x("label",e),placeholder:t.__("Texte Ã  afficher...","siteforge")}),"link"===d.mode&&C.jsx(o.TextControl,{label:t.__("URL","siteforge"),type:"url",value:d.url||"",onChange:e=>x("url",e),placeholder:"https://..."}),"page"===d.mode&&C.jsxs(o.BaseControl,{label:t.__("Rechercher une page","siteforge"),children:[C.jsx(o.ComboboxControl,{value:d.postId,onChange:e=>{const t=p.find(t=>t.value===e);x("postId",e),t&&(x("postTitle",t.title),d.label||x("label",t.title))},options:p,onFilterValueChange:e=>m(e),placeholder:t.__("Tapez pour rechercher...","siteforge")}),g&&C.jsx(o.Spinner,{}),d.postId&&d.postTitle&&C.jsxs("p",{style:{marginTop:"4px",color:"#757575",fontSize:"12px"},children:[t.__("SÃ©lectionnÃ©:","siteforge")," ",C.jsx("strong",{children:d.postTitle})," (ID: ",d.postId,")"]})]}),"phone"===d.mode&&C.jsx(o.TextControl,{label:t.__("NumÃ©ro de tÃ©lÃ©phone","siteforge"),type:"tel",value:d.phone||"",onChange:e=>x("phone",e),placeholder:"+33 1 23 45 67 89"}),"email"===d.mode&&C.jsx(o.TextControl,{label:t.__("Adresse email","siteforge"),type:"email",value:d.email||"",onChange:e=>x("email",e),placeholder:"contact@example.com"}),("link"===d.mode||"page"===d.mode)&&C.jsx(o.SelectControl,{label:t.__("Ouvrir dans","siteforge"),value:d.target||"_self",options:[{value:"_self",label:t.__("MÃªme fenÃªtre","siteforge")},{value:"_blank",label:t.__("Nouvel onglet","siteforge")}],onChange:e=>x("target",e)})]})},J=({field:e,value:l,onChange:r})=>{const i=Array.isArray(l)?l:[],n=e.config||{},s=n.sub_fields,a=(e,t)=>{r(p.move(i,e,t))};return C.jsxs(S,{type:"repeater",children:[C.jsx(F,{label:e.label,help:n.help}),C.jsx("div",{className:"siteforge-repeater-items",children:i.map((e,l)=>C.jsxs("div",{className:"siteforge-repeater-item",children:[C.jsxs("div",{className:"siteforge-repeater-item-header",children:[C.jsxs("span",{className:"siteforge-repeater-item-title",children:[t.__("Item","siteforge")," ",l+1]}),C.jsxs("div",{className:"siteforge-repeater-item-actions",children:[l>0&&C.jsx(o.Button,{variant:"tertiary",icon:"arrow-up-alt2",onClick:()=>a(l,l-1),label:t.__("Move up","siteforge"),size:"small"}),l<i.length-1&&C.jsx(o.Button,{variant:"tertiary",icon:"arrow-down-alt2",onClick:()=>a(l,l+1),label:t.__("Move down","siteforge"),size:"small"}),C.jsx(o.Button,{variant:"tertiary",isDestructive:!0,icon:"trash",onClick:()=>(e=>{r(p.remove(i,e))})(l),label:t.__("Remove","siteforge"),size:"small"})]})]}),C.jsx("div",{className:"siteforge-repeater-item-fields",children:E(s,e,(t,o)=>{((e,t)=>{r(p.update(i,e,t))})(l,{...e,[t]:o})})})]},l))}),C.jsx(o.Button,{variant:"secondary",onClick:()=>{const e=h(s);r(p.add(i,e))},className:"siteforge-repeater-add",children:n.button_label||t.__("Add Item","siteforge")})]})},q=({field:e,value:t,onChange:l})=>{const r=t||{},o=e.config||{},i=o.sub_fields;return C.jsxs(S,{type:"group",children:[C.jsx(F,{label:e.label,help:o.help}),C.jsx("div",{className:"siteforge-group-fields",children:E(i,r,(e,t)=>{l({...r,[e]:t})})})]})};B={text:N,textarea:A,wysiwyg:I,image:D,file:M,select:$,checkbox:U,toggle:H,link:V,icon:W,button:({field:e,value:l,onChange:i})=>{var s;const a=e.config||{},[c,d]=r.useState([]),[p,u]=r.useState([]),[g,f]=r.useState(!0),h=l||{link:{mode:a.default_mode||"link",label:"",url:"",postId:null,postTitle:"",phone:"",email:"",target:"_self"},icon:"",iconPosition:"after",style:"btn-primary"};r.useEffect(()=>{(async()=>{try{const e=await n({path:"/siteforge/v1/button-styles"}),t=Array.isArray(e)?e:[];u(t),d(t.map(e=>({value:e.name,label:e.label||e.name.replace("btn-","")})))}catch(e){console.error("[SiteForge] Error loading button styles:",e),d([{value:"btn-primary",label:"Primaire"}]),u([])}f(!1)})()},[]);const m=e=>{const t=p.find(t=>t.name===e);return(null==t?void 0:t.variables)||{}},x=()=>"false"!==m(h.style).icon,b=(e,t)=>{i({...h,[e]:t})},v=(null==(s=window.siteforgeConfig)?void 0:s.spriteUrl)||"";return C.jsxs(S,{type:"button",children:[C.jsx(F,{label:e.label,help:a.help}),C.jsx("div",{style:{marginBottom:"16px"},children:g?C.jsx(o.Spinner,{}):C.jsx(o.SelectControl,{label:t.__("Style du bouton","siteforge"),value:h.style,options:c,onChange:e=>{var t;const l=(null==(t=p.find(t=>t.name===e))?void 0:t.variables)||{},r={...h,style:e};l["icon-position"]&&(r.iconPosition=l["icon-position"]),l["icon-default"]&&!h.icon&&(r.icon=l["icon-default"]),i(r)}})}),C.jsx("div",{style:{marginBottom:"16px",padding:"12px",backgroundColor:"#f9f9f9",borderRadius:"4px"},children:C.jsx(V,{field:{...e,label:t.__("Lien","siteforge"),config:{...a,modes:a.modes||["link","page","phone","email"]}},value:h.link,onChange:e=>{i({...h,link:e})}})}),x()&&C.jsxs("div",{style:{marginBottom:"16px"},children:[C.jsx(F,{label:t.__("IcÃ´ne","siteforge")}),C.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[h.icon&&v&&C.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",style:{fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},children:C.jsx("use",{href:`${v}#${h.icon}`})}),C.jsx("span",{style:{color:h.icon?"inherit":"#757575"},children:h.icon||t.__("Aucune icÃ´ne","siteforge")}),h.icon&&C.jsx(o.Button,{variant:"link",isDestructive:!0,onClick:()=>b("icon",""),size:"small",children:t.__("Supprimer","siteforge")})]}),C.jsx(W,{field:{...e,label:"",config:{}},value:h.icon,onChange:e=>b("icon",e)}),h.icon&&"false"!==m(h.style)["icon-move"]&&C.jsxs("div",{style:{marginTop:"12px"},children:[C.jsx(F,{label:t.__("Position de l'icÃ´ne","siteforge")}),C.jsxs(o.ButtonGroup,{children:[C.jsx(o.Button,{variant:"before"===h.iconPosition?"primary":"secondary",onClick:()=>b("iconPosition","before"),size:"small",children:t.__("Avant","siteforge")}),C.jsx(o.Button,{variant:"after"===h.iconPosition?"primary":"secondary",onClick:()=>b("iconPosition","after"),size:"small",children:t.__("AprÃ¨s","siteforge")})]})]})]}),!x()&&C.jsx("p",{style:{fontSize:"12px",color:"#757575",fontStyle:"italic"},children:t.__("Les icÃ´nes sont dÃ©sactivÃ©es pour ce style de bouton.","siteforge")})]})},repeater:J,group:q,number:L,range:O,url:P,email:R,color:z};const G=B,Y=({field:e})=>C.jsxs("div",{className:"siteforge-error",children:[C.jsxs("p",{className:"siteforge-error-title",children:[t.__("Error","siteforge"),": ",t.__("Unknown field type","siteforge")]}),C.jsxs("p",{children:[t.__("Field","siteforge"),": ",C.jsx("code",{children:e.name}),C.jsx("br",{}),t.__("Type","siteforge"),": ",C.jsx("code",{children:e.type})]})]}),K=(e,t,l)=>e.map(e=>((e,t,l)=>{const r=G[e.type];return r?C.jsx(r,{field:e,value:t[e.name],onChange:t=>l({[e.name]:t})},e.name):(console.warn(`[SiteForge] Unknown field type: ${e.type} for field: ${e.name}`),C.jsx(Y,{field:e},e.name))})(e,t,l)),Q=(e,l,r,n=null)=>{const s=c(e);if(!s)return null;const a=n||t.__("Block Settings","siteforge");return C.jsx(i.InspectorControls,{children:C.jsx(o.PanelBody,{title:a,initialOpen:!0,children:K(s,l,r)})})},X=(e,t,l,r)=>{const n=c(e);return n?C.jsx(i.InspectorControls,{children:Object.entries(r).map(([e,r])=>{const i=n.filter(e=>r.fields.includes(e.name));return 0===i.length?null:C.jsx(o.PanelBody,{title:r.title,initialOpen:void 0===r.initialOpen||r.initialOpen,children:K(i,t,l)},e)})}):null},Z=(e,t,l,r)=>{const n=c(e);if(!n)return null;const{TabPanel:s}=wp.components,a=r.map(e=>({name:e.name,title:e.title,icon:e.icon,className:`siteforge-tab-${e.name}`}));return C.jsx(i.InspectorControls,{children:C.jsx(s,{tabs:a,children:e=>{const i=r.find(t=>t.name===e.name),s=n.filter(e=>i.fields.includes(e.name));return C.jsx(o.PanelBody,{children:K(s,t,l)})}})})},ee=e=>{const t=c(e);return t?{hasFields:!0,fieldCount:t.length,fieldNames:t.map(e=>e.name),fields:t,getField:e=>t.find(t=>t.name===e)||null}:{hasFields:!1,fieldCount:0,fieldNames:[],fields:[],getField:()=>null}},te=(e,t)=>{const l={};return t.forEach(t=>{const r=`set${t.charAt(0).toUpperCase()}${t.slice(1)}`;l[r]=l=>e({[t]:l})}),l},le=({blockName:e,attributes:t,setAttributes:l,panelTitle:r,sections:o,children:i})=>{const n=o?X(e,t,l,o):Q(e,t,l,r);return C.jsxs(C.Fragment,{children:[n,i]})},re=({container:e,allowedBlocks:t,template:l,templateLock:o})=>e?r.createPortal(r.createElement(i.InnerBlocks,{allowedBlocks:t,template:l,templateLock:o}),e):null,oe=({attributes:e,setAttributes:l,blockName:n,clientId:s})=>{const c=r.useRef(null),[d,p]=r.useState(null),[u,g]=r.useState(null),f=Q(n,e,l),h=i.useBlockProps({className:"siteforge-block-editor-wrapper",ref:c});return r.useEffect(()=>{if(!c.current)return;const e=e=>{const t=document.createElement("textarea");return t.innerHTML=e,t.value},t=new MutationObserver(()=>{const t=c.current.querySelector(".sf-inner-blocks");if(t&&t!==d){let r,o;try{const l=t.getAttribute("data-allowed-blocks"),i=t.getAttribute("data-template");r=l?JSON.parse(e(l)):void 0,o=i?JSON.parse(e(i)):void 0}catch(l){console.error("[SiteForge] Error parsing InnerBlocks config:",l)}const i={allowedBlocks:r,template:o,templateLock:"false"!==t.dataset.templateLock&&(t.dataset.templateLock||!1)};t.dataset.processed||(t.dataset.processed="true",g(i),p(t))}});t.observe(c.current,{childList:!0,subtree:!0});const l=c.current.querySelector(".sf-inner-blocks");if(l){let t,o;try{const r=l.getAttribute("data-allowed-blocks"),i=l.getAttribute("data-template");t=r?JSON.parse(e(r)):void 0,o=i?JSON.parse(e(i)):void 0}catch(r){console.error("[SiteForge] Error parsing initial InnerBlocks config:",r)}const i={allowedBlocks:t,template:o,templateLock:"false"!==l.dataset.templateLock&&(l.dataset.templateLock||!1)};l.dataset.processed||(l.dataset.processed="true",g(i),p(l))}return()=>t.disconnect()},[]),r.createElement(r.Fragment,null,[f,r.createElement("div",h,[r.createElement(a.ServerSideRender,{key:"server-side-render",block:n,attributes:e,httpMethod:"POST",LoadingResponsePlaceholder:()=>r.createElement(o.Placeholder,{icon:"block-default",label:t.__("Chargement...","siteforge")},r.createElement(o.Spinner)),ErrorResponsePlaceholder:({response:e})=>r.createElement(o.Placeholder,{icon:"warning",label:t.__("Erreur de rendu","siteforge")},r.createElement("div",{style:{color:"#d94f4f"}},(null==e?void 0:e.message)||t.__("Impossible de charger le bloc","siteforge")))})]),d&&u&&r.createElement(re,{key:"inner-blocks-portal",container:d,allowedBlocks:u.allowedBlocks,template:u.template,templateLock:u.templateLock})])},ie=()=>r.createElement(i.InnerBlocks.Content),ne=()=>{if(void 0===window.siteforgeBlocks)return void console.warn("[SiteForge] No blocks to register");const e=window.siteforgeBlocks;Object.keys(e).forEach(t=>{const l=e[t];if(wp.blocks.getBlockType(t))return void console.log(`[SiteForge] Block ${t} already registered in JavaScript, skipping`);console.log(`[SiteForge] Registering block ${t}...`);const o={};l.fields&&Array.isArray(l.fields)&&l.fields.forEach(e=>{const t=e.config||{};let l="string";const r={text:"string",textarea:"string",wysiwyg:"string",select:"string",checkbox:"boolean",number:"number",range:"number",url:"string",email:"string",color:"string",icon:"string",link:"object",repeater:"array",group:"object"};if(r[e.type]&&(l=r[e.type]),"image"===e.type){const e=t.return_value||"url";l="id"===e?"number":"object"===e?"object":"string"}o[e.name]={type:l},void 0!==t.default?o[e.name].default=t.default:"object"===l?o[e.name].default={}:"array"===l&&(o[e.name].default=[])});try{s.registerBlockType(t,{title:l.title||t,description:l.description||"",category:"siteforge",icon:l.icon||"block-default",supports:l.supports||{align:!0,anchor:!0,spacing:{margin:!0,padding:!0}},attributes:o,edit:e=>r.createElement(oe,{...e,blockName:t}),save:ie}),console.log(`[SiteForge] âœ… Block ${t} registered with ${Object.keys(o).length} attributes`)}catch(i){console.error(`[SiteForge] âŒ Failed to register block ${t}:`,i)}})};return"undefined"!=typeof wp&&void 0!==wp.blocks?ne():console.warn("[SiteForge] WordPress blocks API not available"),window.SiteForge=window.SiteForge||{},window.SiteForge.helpers=y,window.SiteForge.getBlockFields=c,window.SiteForge.getBlockData=d,window.SiteForge.arrayHelpers=p,window.SiteForge.imageHelpers=u,window.SiteForge.objectHelpers=g,window.SiteForge.styleHelpers=m,window.SiteForge.FieldControls=G,window.SiteForge.getFieldComponent=T,window.SiteForge.FieldWrapper=S,window.SiteForge.FieldLabel=F,window.SiteForge.createFieldControls=Q,window.SiteForge.createSectionedFieldControls=X,window.SiteForge.createTabbedFieldControls=Z,window.SiteForge.useSiteForgeFields=ee,window.SiteForge.useAttributeSetters=te,window.SiteForge.SiteForgeBlockControls=le,window.SiteForge.registerSiteForgeBlocks=ne,window.siteforgeBlocks&&("undefined"!=typeof wp&&void 0!==wp.domReady?wp.domReady(()=>{ne()}):window.addEventListener("load",()=>{ne()})),e.CheckboxField=U,e.ColorField=z,e.EmailField=R,e.FieldControls=G,e.FieldLabel=F,e.FieldWrapper=S,e.FileField=M,e.GroupField=q,e.ImageField=D,e.NumberField=L,e.RangeField=O,e.RepeaterField=J,e.SelectField=$,e.SiteForgeBlockControls=le,e.TextField=N,e.TextareaField=A,e.ToggleField=H,e.UrlField=P,e.WysiwygField=I,e.arrayHelpers=p,e.createAttributeSetter=b,e.createAttributeSetters=v,e.createFieldControls=Q,e.createRepeaterItemDefaults=h,e.createSectionedFieldControls=X,e.createTabbedFieldControls=Z,e.default=Q,e.getBlockData=d,e.getBlockFields=c,e.getFieldComponent=T,e.helpers=y,e.imageHelpers=u,e.normalizeField=f,e.objectHelpers=g,e.registerSiteForgeBlocks=ne,e.renderSubFields=E,e.styleHelpers=m,e.useAttributeSetters=te,e.useSiteForgeFields=ee,e.validationHelpers=x,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),e}({},wp.i18n,React,wp.element,wp.components,wp.blockEditor,wp.apiFetch,wp.blocks,wp.serverSideRender);
//# sourceMappingURL=editor.js.map
