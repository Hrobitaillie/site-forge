!function(e,t,n,l,a,o,r,i){"use strict";const c="sif/buttons-v2";e.registerBlockType(c,{icon:{src:React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"552",height:"424",fill:"none",viewBox:"0 0 552 424"},React.createElement("path",{fill:"currentColor","fill-rule":"evenodd",d:"M439.86 30.456H112.347c-45.049 0-81.568 36.52-81.568 81.568 0 45.049 36.52 81.569 81.568 81.569H439.86c45.049 0 81.568-36.52 81.568-81.569s-36.519-81.568-81.568-81.568Zm-327.513-30C50.73.456.779 50.406.779 112.024c0 61.618 49.95 111.569 111.568 111.569H439.86c61.617 0 111.568-49.951 111.568-111.569C551.428 50.407 501.477.456 439.86.456H112.347Z","clip-rule":"evenodd"}),React.createElement("path",{fill:"white",d:"M448.627 192.55c12.759-7.367 29.788-2.804 37.154 9.955l27.199 47.11c22.666 39.259 8.901 89.082-29.866 111.464l-47.111 27.199c-21.101 12.183-46.887 13.985-68.789 4.383l-79.222-34.087c-4.927-1.735-8.175-5.094-10.442-9.02-6.516-11.287-2.783-25.22 7.522-31.169 6.38-3.684 13.968-4.139 20.728-1.498l40.431 17.373c2.652 1.139 5.226-1.757 3.783-4.257l-86.998-150.684c-6.233-10.796-2.99-24.445 8.297-30.962 10.796-6.233 24.729-2.5 30.962 8.296l38.594 66.847c1.336 2.315 5.069 1.917 6.468-.36 2.133-3.469 5.184-6.51 9.173-8.814 9.034-5.216 19.897-4.361 28.473 1.25 2.3 1.505 6.234-.008 6.994-2.65 1.816-6.308 5.932-12.032 12.251-15.68 9.984-5.765 22.201-4.114 31.097 3.176 1.667 1.366 4.307.945 5.535-.826 1.893-2.731 4.399-5.102 7.767-7.046Z"}),React.createElement("path",{fill:"currentColor","fill-rule":"evenodd",d:"m305.8 316.887 40.431 17.373c2.652 1.139 5.226-1.757 3.783-4.256L263.016 179.32c-6.233-10.797-2.99-24.446 8.297-30.963 10.796-6.233 24.729-2.499 30.962 8.297l38.594 66.846c1.336 2.315 5.069 1.917 6.468-.36 1.718-2.794 4.031-5.311 6.951-7.387a27.743 27.743 0 0 1 2.222-1.426c.744-.43 1.5-.818 2.267-1.166 8.541-3.877 18.336-2.733 26.206 2.415 2.3 1.505 6.234-.008 6.994-2.65 1.816-6.308 5.932-12.032 12.251-15.68 9.984-5.765 22.201-4.114 31.097 3.176 1.667 1.366 4.308.945 5.536-.826 1.892-2.731 4.398-5.102 7.766-7.046 12.759-7.366 29.788-2.803 37.154 9.956l27.199 47.11c22.666 39.258 8.901 89.081-29.866 111.464l-47.11 27.199c-21.102 12.183-46.888 13.984-68.79 4.382l-79.222-34.086c-4.927-1.735-8.175-5.095-10.442-9.02-6.516-11.287-2.783-25.22 7.522-31.17 6.38-3.683 13.969-4.139 20.728-1.498Zm-27.065 64.92 78.527 33.788c29.507 12.902 63.61 10.288 91.242-5.666l47.11-27.199c50.627-29.229 68.643-94.301 39.017-145.614l-27.199-47.11c-14.27-24.717-46.589-33.377-71.305-19.107-.502.29-.996.586-1.482.888-13.542-4.766-29.053-4.196-42.917 3.808a51.399 51.399 0 0 0-13.333 11.037c-9.218-1.611-18.962-.796-28.209 3.006l-26.261-45.484c-13.136-22.754-42.359-30.584-65.112-17.447-23.598 13.624-30.378 42.716-17.447 65.113l56.814 98.405a48.627 48.627 0 0 0-25.608 6.509c-22.96 13.256-29.683 42.786-16.673 65.321 4.337 7.51 11.498 15.47 22.836 19.752Z","clip-rule":"evenodd"}))},edit:function({attributes:e,setAttributes:c,clientId:s}){console.log("[buttons-v2] Edit component mounted"),console.log("[buttons-v2] attributes:",e),console.log("[buttons-v2] clientId:",s),console.log("[buttons-v2] window.siteforgeConfig:",window.siteforgeConfig);const{data:u={settings:{justifyValue:"justify-start",flexWrap:!0,gap:"1rem"},buttons:[]}}=e,p=e=>e.map((e,t)=>({...e,id:e.id||`${s}-btn-${t}-${Date.now()}`})),{settings:d,buttons:m}=u,[g,y]=a.useState([]),[v,f]=a.useState([]),[h,b]=a.useState(!0);a.useEffect(()=>{if(m.some(e=>!e.id)&&m.length>0){const e=p(m);c({data:{...u,buttons:e}})}},[s]),a.useEffect(()=>{(async()=>{console.log("[buttons-v2] Fetching button styles from API...");try{const e=await i({path:"/siteforge/v1/button-styles"});console.log("[buttons-v2] Button styles received:",e);const t=e.map(e=>{var t;return{label:(null==(t=e.variables)?void 0:t.title)||e.label||e.name.replace(/^btn-/,"").replace(/-/g," "),value:e.name}});y(t),f(e)}catch(e){console.error("[buttons-v2] Erreur API button-styles:",e),y([{label:"Primaire",value:"btn-primary"}]),f([])}finally{b(!1)}})()},[]);const E=(e,t)=>{c({data:{...u,settings:{...d,[e]:t}}})},R=(e,t,n)=>{const l=[...m];"link"!==t||l[e].link||(l[e].link={url:"",title:"",target:"",type:"url",postId:0,termId:0,taxonomy:"",postType:""}),l[e][t]=n,c({data:{...u,buttons:l}})},C=e=>{const t=document.createElement("textarea");return t.innerHTML=e,t.value},k=e=>{const t=v.find(t=>t.name===e);return(null==t?void 0:t.variables)||{}},x=e=>"false"!==k(e).icon,w=e=>"false"!==k(e)["icon-move"],T=e=>k(e)["icon-position"]||"after",j=e=>k(e)["icon-default"]||"",$=e=>{const t=k(e.type);return!("false"!==t.icon||!t["icon-default"])||x(e.type)&&e.icon},_=e=>{const t=k(e.type);return"false"===t.icon&&t["icon-default"]?t["icon-default"]:e.icon||(t["icon-default"]?t["icon-default"]:"")},S=({value:e,onChangeId:t,onChangeType:l})=>{var r;const[i,c]=a.useState(""),s=["post","attachment","wp_template_part","wp_template","nav_menu_item","wp_navigation"],u=o.useSelect(e=>e("core").getPostTypes({per_page:-1}),[]),p=o.useSelect(e=>{const t={};return u?(u.forEach(n=>{s.includes(n.slug)||(t[n.slug]=e("core").getEntityRecords("postType",n.slug,{per_page:-1}))}),t):{}},[u]),d=a.useMemo(()=>{if(!p||!u)return[];let e=[];return u.forEach(t=>{if(s.includes(t.slug))return;const n=p[t.slug];if(!n||!Array.isArray(n))return;const l=n.filter(e=>e&&e.title&&e.title.rendered&&e.title.rendered.toLowerCase().includes(i.toLowerCase()));l.length>0&&(e.push({value:`__group_${t.slug}`,label:`--- ${t.labels.singular_name} ---`,disabled:!0}),l.forEach(n=>{var l;e.push({value:`${t.slug}|${n.id}`,label:C((null==(l=n.title)?void 0:l.rendered)||n.title||`Post #${n.id}`)})}))}),e},[p,u,i]);return React.createElement(n.ComboboxControl,{label:"Sélectionner un contenu",value:e&&(null==(r=d.find(t=>t.value.endsWith(`|${e}`)))?void 0:r.value)||"",onChange:e=>{if(!e||!e.includes("|"))return;const[n,a]=e.split("|");l(n),t(parseInt(a))},onFilterValueChange:c,options:d})},B=({postType:e,onChangeType:t})=>{const l=o.useSelect(e=>e("core").getPostTypes({per_page:-1}),[]),r=a.useMemo(()=>l?l.filter(e=>e.has_archive).map(e=>({value:e.slug,label:C(e.labels.name)})):[],[l]);return React.createElement(n.SelectControl,{label:"Type de contenu (archive)",value:e,options:[{label:"Sélectionner...",value:""},...r],onChange:e=>t(e)})},I=({value:e,taxonomy:t,onChangeId:l,onChangeTaxo:r})=>{var i;const[c,s]=a.useState(""),u=["category"],p=o.useSelect(e=>e("core").getTaxonomies({per_page:-1}),[]),d=o.useSelect(e=>{const t={};return p?(p.forEach(n=>{u.includes(n.slug)||(t[n.slug]=e("core").getEntityRecords("taxonomy",n.slug,{per_page:-1}))}),t):{}},[p]),m=a.useMemo(()=>{if(!d||!p)return[];let e=[];return p.forEach(t=>{if(u.includes(t.slug))return;const n=d[t.slug];if(!n||!Array.isArray(n))return;const l=n.filter(e=>e&&e.name&&e.name.toLowerCase().includes(c.toLowerCase()));l.length>0&&(e.push({value:`__group_${t.slug}`,label:`--- ${t.labels.singular_name} ---`,disabled:!0}),l.forEach(n=>{e.push({value:`${t.slug}|${n.id}`,label:C(n.name||`Terme #${n.id}`)})}))}),e},[d,p,c]);return React.createElement(n.ComboboxControl,{label:"Sélectionner un terme",value:e&&(null==(i=m.find(t=>t.value.endsWith(`|${e}`)))?void 0:i.value)||"",onChange:e=>{if(!e||!e.includes("|"))return;const[t,n]=e.split("|");r(t),l(parseInt(n))},onFilterValueChange:s,options:m})},L=({value:e,onChange:t})=>{var o;const[c,s]=a.useState(!1),[u,p]=a.useState(""),[d,m]=a.useState([]),[g,y]=a.useState(!1),v=(null==(o=window.siteforgeConfig)?void 0:o.spriteUrl)||"";a.useEffect(()=>{c&&0===d.length&&(async()=>{y(!0),console.log("[buttons-v2] Fetching icons from API...");try{const e=await i({path:"/siteforge/v1/icons"});console.log("[buttons-v2] Icons received:",e),m(e.icons||[])}catch(e){console.error("[buttons-v2] Erreur lors de la récupération des icônes:",e),m([])}finally{y(!1)}})()},[c,d.length]);const f=d.filter(e=>e.toLowerCase().includes(u.toLowerCase())),h=e&&v?React.createElement("svg",{width:"16",height:"16",viewBox:"0 0 24 24",style:{marginRight:"8px",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}},React.createElement("use",{href:`${v}#${e}`})):null;return React.createElement(React.Fragment,null,React.createElement(n.BaseControl,{label:"Icône Lucide"},React.createElement("div",{style:{display:"flex",alignItems:"center",gap:"8px"}},h,React.createElement(n.Button,{variant:"secondary",onClick:()=>s(!0),style:{flex:1}},e?`Changer l'icône (${e})`:"Ajouter une icône"),e&&React.createElement(n.Button,{isDestructive:!0,variant:"secondary",onClick:()=>t(""),icon:l.trash,label:"Supprimer l'icône"}))),c&&React.createElement(n.Modal,{title:"Sélectionner une icône Lucide",onRequestClose:()=>s(!1),style:{maxWidth:"800px",minWidth:"400px",zIndex:1000001}},React.createElement("div",null,React.createElement(n.SearchControl,{value:u,onChange:p,placeholder:"Rechercher une icône...",style:{marginBottom:"16px"}}),u&&React.createElement("div",{style:{marginBottom:"8px",fontSize:"12px",color:"#666"}},r.sprintf(r._n('%1$s résultat pour "%2$s"','%1$s résultats pour "%2$s"',f.length,"siteforge"),new Intl.NumberFormat("fr-FR").format(f.length),u)),g?React.createElement("div",{style:{textAlign:"center",padding:"40px"}},React.createElement(n.Spinner,null),React.createElement("p",{style:{marginTop:"12px",color:"#666"}},"Chargement des icônes...")):React.createElement(React.Fragment,null,React.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(50px, 1fr))",gap:"4px",maxHeight:"400px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px",padding:"12px",width:"400px"}},f.slice(0,100).map(l=>React.createElement(n.Button,{key:l,variant:e===l?"primary":"secondary",onClick:()=>(e=>{t(e),s(!1)})(l),style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",minHeight:"40px",minWidth:"40px"},title:l},React.createElement("svg",{width:"20",height:"20",viewBox:"0 0 24 24",style:{fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}},React.createElement("use",{href:`${v}#${l}`}))))),f.length>100&&React.createElement("p",{style:{textAlign:"center",color:"#888",fontSize:"12px",marginTop:"12px"}},"... et ",new Intl.NumberFormat("fr-FR").format(f.length-100)," autres résultats. Affinez votre recherche")),!g&&0===f.length&&React.createElement("p",{style:{textAlign:"center",color:"#666",marginTop:"20px"}},'Aucune icône trouvée pour "',u,'"'))))},A=m.length;return React.createElement(React.Fragment,null,React.createElement(t.InspectorControls,null,React.createElement(n.PanelBody,{title:"Mise en page des boutons",initialOpen:!0},React.createElement(n.BaseControl,{label:"Alignement"},React.createElement(n.ButtonGroup,null,React.createElement(n.Button,{icon:l.justifyLeft,label:"Aligné à gauche",onClick:()=>E("justifyValue","justify-start"),isPressed:"justify-start"===d.justifyValue,variant:"justify-start"===d.justifyValue?"primary":"secondary"}),React.createElement(n.Button,{icon:l.justifyCenter,label:"Centré",onClick:()=>E("justifyValue","justify-center"),isPressed:"justify-center"===d.justifyValue,variant:"justify-center"===d.justifyValue?"primary":"secondary"}),React.createElement(n.Button,{icon:l.justifyRight,label:"Aligné à droite",onClick:()=>E("justifyValue","justify-end"),isPressed:"justify-end"===d.justifyValue,variant:"justify-end"===d.justifyValue?"primary":"secondary"}),A>1&&React.createElement(n.Button,{icon:l.justifySpaceBetween,label:"Espacé entre les boutons",onClick:()=>E("justifyValue","justify-between"),isPressed:"justify-between"===d.justifyValue,variant:"justify-between"===d.justifyValue?"primary":"secondary"}))),A>1&&React.createElement(React.Fragment,null,React.createElement(n.TextControl,{label:"Gap entre les boutons",onChange:e=>E("gap",e),value:d.gap}),React.createElement(n.ToggleControl,{label:"Retour à la ligne",checked:d.flexWrap,onChange:e=>E("flexWrap",e)})))),React.createElement("div",{...t.useBlockProps()},React.createElement("div",{className:`pib-buttons flex ${d.flexWrap?"flex-wrap":""} ${d.justifyValue||""}`,style:{gap:d.gap}},p(m).map((e,a)=>{var o,r;return React.createElement("div",{key:e.id||`fallback-${a}`,className:"pib-button-item"},React.createElement(t.BlockControls,{group:"block"},React.createElement(n.ToolbarGroup,null,React.createElement(n.Dropdown,{renderToggle:({isOpen:t,onToggle:a})=>React.createElement(n.ToolbarButton,{icon:l.settings,label:`Bouton "${e.title}"`,onClick:a,isPressed:t}),renderContent:()=>{var t,l,o,r,i,c,s,u,p,d,m,y,v,f,b,E;return React.createElement("div",{style:{padding:"0",minWidth:"260px"}},React.createElement(n.PanelBody,{title:"Lien du bouton",initialOpen:!0},React.createElement(n.SelectControl,{label:"Type de lien",value:(null==(t=e.link)?void 0:t.type)||"url",options:[{label:"URL personnalisée",value:"url"},{label:"Contenu (pages / CPT)",value:"post"},{label:"Archive (CPT)",value:"archive"},{label:"Terme (taxonomies)",value:"term"},{label:"Mail",value:"mail"},{label:"Téléphone",value:"tel"}],onChange:t=>{const n=e.link||{};R(a,"link",{...n,type:t}),"mail"===t&&R(a,"link",{...n,url:"mailto:",type:t}),"tel"===t&&R(a,"link",{...n,url:"tel:",type:t})}}),"url"===((null==(l=e.link)?void 0:l.type)||"url")&&React.createElement("input",{type:"url",value:(null==(o=e.link)?void 0:o.url)||"",placeholder:"https://...",style:{width:"100%",marginTop:"10px"},onChange:t=>{const n=e.link||{};R(a,"link",{...n,url:t.target.value})}}),"mail"===((null==(r=e.link)?void 0:r.type)||"url")&&React.createElement("input",{type:"email",value:((null==(i=e.link)?void 0:i.url)||"").replace("mailto:",""),placeholder:"email@example.com",style:{width:"100%",marginTop:"10px"},onChange:t=>{const n=e.link||{};R(a,"link",{...n,url:`mailto:${t.target.value}`})}}),"tel"===((null==(c=e.link)?void 0:c.type)||"url")&&React.createElement("input",{type:"tel",value:((null==(s=e.link)?void 0:s.url)||"").replace("tel:",""),placeholder:"+33612345678",style:{width:"100%",marginTop:"10px"},onChange:t=>{const n=e.link||{};R(a,"link",{...n,url:`tel:${t.target.value}`})}}),"post"===((null==(u=e.link)?void 0:u.type)||"url")&&React.createElement(S,{value:(null==(p=e.link)?void 0:p.postId)||0,onChangeId:t=>{const n={...e.link||{},postId:t};R(a,"link",n)},onChangeType:t=>{const n={...e.link||{},postType:t};R(a,"link",n)}}),"archive"===((null==(d=e.link)?void 0:d.type)||"url")&&React.createElement(B,{postType:(null==(m=e.link)?void 0:m.postType)||"",onChangeType:t=>{const n=e.link||{};R(a,"link",{...n,postType:t})}}),"term"===((null==(y=e.link)?void 0:y.type)||"url")&&React.createElement(I,{value:(null==(v=e.link)?void 0:v.termId)||0,taxonomy:(null==(f=e.link)?void 0:f.taxonomy)||"",onChangeId:t=>{const n={...e.link||{},termId:t};R(a,"link",n)},onChangeTaxo:t=>{const n={...e.link||{},taxonomy:t};R(a,"link",n)}}),!["mail","tel"].includes((null==(b=e.link)?void 0:b.type)||"url")&&React.createElement("div",{style:{marginTop:"10px"}},React.createElement(n.ToggleControl,{label:"Ouvrir dans un nouvel onglet",checked:"_blank"===((null==(E=e.link)?void 0:E.target)||""),onChange:t=>{const n=e.link||{};R(a,"link",{...n,target:t?"_blank":""})}}))),React.createElement(n.PanelBody,{title:"Apparence du bouton",initialOpen:!0},h?React.createElement(n.Spinner,null):React.createElement(n.SelectControl,{label:"Style du bouton",value:e.type,options:g,onChange:t=>{R(a,"type",t);const n=T(t);R(a,"icon_position",n);const l=j(t),o=k(t);("false"===o.icon&&o["icon-default"]||!e.icon&&o["icon-default"])&&R(a,"icon",l)}}),x(e.type)&&React.createElement("div",{style:{marginTop:"16px"}},React.createElement(L,{value:e.icon||"",onChange:e=>R(a,"icon",e)})),e.icon&&x(e.type)&&w(e.type)&&React.createElement("div",{style:{marginTop:"12px"}},React.createElement(n.BaseControl,{label:"Position de l'icône"},React.createElement(n.__experimentalToggleGroupControl,{value:e.icon_position||T(e.type),onChange:e=>R(a,"icon_position",e),isBlock:!0},React.createElement(n.__experimentalToggleGroupControlOption,{value:"before",label:"Avant le texte"}),React.createElement(n.__experimentalToggleGroupControlOption,{value:"after",label:"Après le texte"})))),(!x(e.type)||!w(e.type))&&React.createElement("div",{style:{marginTop:"12px",padding:"8px",backgroundColor:"#f0f0f0",borderRadius:"4px",fontSize:"12px",color:"#666"}},!x(e.type)&&React.createElement("div",null,"Les icônes sont désactivées pour ce style de bouton"),x(e.type)&&!w(e.type)&&React.createElement("div",null,"La position de l'icône est fixe pour ce style de bouton"))))}}))),React.createElement("div",{className:"pib-button-wrapper"},React.createElement("span",{className:`pib-button ${e.type}`,style:{display:"flex",alignItems:"center",gap:"8px"}},$(e)&&"before"===(e.icon_position||T(e.type))&&React.createElement("svg",{width:"16",height:"16",viewBox:"0 0 24 24",style:{fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}},React.createElement("use",{href:`${(null==(o=window.siteforgeConfig)?void 0:o.spriteUrl)||""}#${_(e)}`})),React.createElement(t.RichText,{tagName:"span",value:e.title,placeholder:"Texte du bouton",onChange:e=>R(a,"title",e),allowedFormats:[],withoutInteractiveFormatting:!0}),$(e)&&"after"===(e.icon_position||T(e.type))&&React.createElement("svg",{width:"16",height:"16",viewBox:"0 0 24 24",style:{fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}},React.createElement("use",{href:`${(null==(r=window.siteforgeConfig)?void 0:r.spriteUrl)||""}#${_(e)}`}))),React.createElement(n.Button,{isDestructive:!0,onClick:()=>(e=>{const t=[...m];t.splice(e,1),c({data:{...u,buttons:t}})})(a),className:"pib-remove-btn",label:"Supprimer",showTooltip:!0,icon:React.createElement(n.Icon,{icon:l.trash})})))})),React.createElement(n.Button,{variant:"primary",onClick:()=>{const e=g.length?g[0].value:"btn-primary",t=T(e),n=j(e);c({data:{...u,buttons:[...m,{id:`${s}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,title:"Texte du bouton",type:e,icon:n,icon_position:t,link:{url:"",title:"",target:"",type:"url",postId:0,termId:0,taxonomy:"",postType:""},class:"",download:!1,data:{}}]}})},style:{marginTop:"12px"}},"+ Ajouter un bouton")))}})}(wp.blocks,wp.blockEditor,wp.components,wp.primitives,wp.element,wp.data,wp.i18n,wp.apiFetch);
//# sourceMappingURL=index.js.map
